{% extends 'base.html' %}

{% block title %}Auth | Sales Tracker{% endblock %}

{% block extra_head %}
<style>
  /* minimal styles pulled from the original onboard page to keep layout consistent */
  :root {
    --bg: #f7f7f8;
    --fg: #222;
    --card: #fff;
    --accent: #0078d4;
    --border: #ddd;
    --input-bg: #fff;
    --input-fg: #222;
  }
  [data-theme="dark"] {
    --bg: #121212;
    --fg: #f5f5f5;
    --card: #1e1e1e;
    --accent: #0ea5e9;
    --border: #333;
    --input-bg: #2a2a2a;
    --input-fg: #f5f5f5;
  }

  /* ensure the auth card is centered inside base main */
  .auth-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
    width: 100%;
    max-width: 420px;
    padding: 1.5rem;
    box-shadow: 0 4px 10px rgba(0,0,0,0.06);
    margin: 2rem auto;
  }

  .tabs { display:flex; border-bottom:1px solid var(--border); margin-bottom:1rem; }
  .tab { flex:1; text-align:center; padding:.5rem; cursor:pointer; }
  .tab.active { color: var(--accent); border-bottom:2px solid var(--accent); }

  /* ensure inputs and buttons align and fill the card width */
  *, *::before, *::after { box-sizing: border-box; }

  input {
    width: 100%;
    padding: .6rem .75rem;
    border: 1px solid var(--border);
    border-radius: 6px;
    background: var(--input-bg);
    color: var(--input-fg);
  }

  /* full-width primary buttons */
  .submit-btn {
    display: block;
    width: 100%;
    padding: .65rem .75rem;
    border: none;
    border-radius: 6px;
    background: var(--accent);
    color: #fff;
    cursor: pointer;
    text-align: center;
    font-weight: 500;
  }

  /* full-width alternate (Google) button that follows theme */
  .submit-btn.alt {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: .6rem;
    width: 100%;
    padding: .6rem .75rem;
    border-radius: 6px;
    background: var(--input-bg);
    color: var(--input-fg);
    border: 1px solid var(--border);
  }

  /* ensure lucide icon inside alt button sizes nicely */
  .submit-btn.alt i[data-lucide] { width: 18px; height: 18px; }

  /* centered "or" divider */
  .or-divider {
    text-align: center;
    margin-top: .5rem;
    margin-bottom: .5rem;
    color: var(--input-fg);
    opacity: .85;
    font-size: .95rem;
  }

  /* keep spacing consistent */
  form { display:flex; flex-direction:column; gap:.75rem; }
  .input-group { display:flex; flex-direction:column; gap:.5rem; }
  .input-row { display:flex; gap:.5rem; }
  .input-row .field { flex:1; }

  @media (max-width:480px) {
    .input-row { flex-direction:column; }
  }
</style>
{% endblock %}

{% block content %}
<div class="auth-card" role="main" aria-labelledby="auth-heading">
  <h2 id="auth-heading" style="display:none">Authentication</h2>

  <div class="tabs" role="tablist">
    <div class="tab active" id="loginTab" role="tab" tabindex="0">Login</div>
    <div class="tab" id="signupTab" role="tab" tabindex="0">Sign Up</div>
  </div>

  <!-- Login form: grouped cleanly -->
  <form id="loginForm" method="post" action="{% url 'login' %}">
    {% csrf_token %}
    <input type="hidden" name="is_login" value="login">
    <div class="input-group">
      <label for="login_email" class="sr-only" style="display:none">Email</label>
      <input id="login_email" name="login_email" type="email" placeholder="Email" required>
    </div>

    <div class="input-group">
      <label for="login_password" class="sr-only" style="display:none">Password</label>
      <input id="login_password" name="login_password" type="password" placeholder="Password" required>
    </div>

    <button type="submit" class="submit-btn">Login</button>

    <div class="or-divider">or</div>

    <button type="button" class="submit-btn alt" aria-label="Continue with Google">
      <i data-lucide="mail"></i><span>Continue with Google</span>
    </button>
  </form>

  <!-- Signup form: grouped (full name + email) and (username + passwords) -->
  <form id="signupForm" method="post" action="{% url 'login' %}" style="display:none;">
    {% csrf_token %}
    <input type="hidden" name="is_login" value="signup">

    <div class="input-group" aria-label="Name and email">
      <input name="name" type="text" placeholder="Full Name" required>
      <input name="email" type="email" placeholder="Email" required>
    </div>

    <div class="input-group" aria-label="Username and passwords">
      <div class="input-row">
        <div class="field"><input name="username" type="text" placeholder="Username" required></div>
      </div>
      <div class="input-row">
        <div class="field"><input name="password" type="password" placeholder="Password" required></div>
        <div class="field"><input name="conf_password" type="password" placeholder="Confirm Password" required></div>
      </div>
    </div>

    <button type="submit" class="submit-btn">Sign Up</button>

    <div class="or-divider">or</div>

    <button type="button" class="submit-btn alt" aria-label="Sign up with Google">
      <i data-lucide="mail"></i><span>Sign Up with Google</span>
    </button>
  </form>

  {% if messages %}
    {% for message in messages %}
      <p class="p-error">{{ message }}</p>
    {% endfor %}
  {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  lucide.createIcons();

  const loginTab = document.getElementById('loginTab');
  const signupTab = document.getElementById('signupTab');
  const loginForm = document.getElementById('loginForm');
  const signupForm = document.getElementById('signupForm');

  function showLogin() {
    loginTab.classList.add('active');
    signupTab.classList.remove('active');
    loginForm.style.display = 'block';
    signupForm.style.display = 'none';
  }
  function showSignup() {
    signupTab.classList.add('active');
    loginTab.classList.remove('active');
    signupForm.style.display = 'block';
    loginForm.style.display = 'none';
  }

  loginTab.addEventListener('click', showLogin);
  signupTab.addEventListener('click', showSignup);
  // keyboard accessible toggles
  loginTab.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); showLogin(); } });
  signupTab.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); showSignup(); } });
</script>
{% endblock %}
